这个脚本的作用是实现以下功能：

定时检测服务可用性：定期（每分钟）通过 TCP ping 检测主要服务（MAIN_IP:MAIN_PORT）是否可用。

服务不可用时切换 DNS 记录：当检测到主要服务不可用时，自动将 Cloudflare 管理的指定域名（CFRECORD_NAME）的 DNS 记录更新为备用 IP 中的一个（按顺序尝试）。

备用 IP 切换逻辑：依次检测备用 IP 中的每一个 IP 的端口，确认端口可用后，将 DNS 记录更新为该 IP。

异常处理和通知：如果更新 DNS 记录时发生异常（如未能获取 Zone ID 和 Record ID），则记录异常并停止 DNS 记录更新。

恢复到主要服务：一旦主要服务恢复正常（通过 TCP ping 可达），将自动将 DNS 记录切换回主要服务的 IP。

总之，该脚本通过自动监测服务的可用性，并在服务不可用时切换到备用 IP，实现了基于 DNS 记录的高可用性保障。

使用方法：
配置 Cloudflare 认证信息：

在脚本中设置 Cloudflare 的 API key (CFKEY) 和用户名 (CFUSER)，以及管理的域名 (CFZONE_NAME) 和记录名称 (CFRECORD_NAME)。
确保在 Cloudflare 控制台上已经设置了正确的域名和 DNS 记录，并且 API key 具有足够的权限进行 DNS 记录的更新。
配置主要服务和备用 IP：

设置 MAIN_IP 和 MAIN_PORT，即主要服务的 IP 地址和端口。
设置 BACKUP_IPS 列表，包含备用 IP 的 IP 地址。确保列表中的 IP 地址是按照优先级排列的，脚本会按顺序尝试更新 DNS 记录。
运行脚本：

在终端中运行 python3 jiancha.py（假设脚本名为 jiancha.py），启动脚本开始监测和自动切换 DNS 记录。
脚本会每分钟检测一次主要服务的可用性。如果发现主要服务不可用，将尝试更新 DNS 记录到备用 IP 中的一个可用 IP。
异常处理和通知：

如果在更新 DNS 记录时遇到异常（如无法获取 Zone ID 和 Record ID），脚本会记录错误并停止尝试更新 DNS 记录。
使用日志文件记录脚本的运行状态和事件，可以查看日志来了解脚本的行为和问题。
恢复到主要服务：

一旦主要服务恢复正常（通过 TCP ping 可达），脚本会自动将 DNS 记录切换回主要服务的 IP，确保服务的持续可用性。
注意事项：
权限和环境设置：确保脚本运行的环境中具有足够的权限访问网络和执行 DNS 记录更新操作。
定期检查日志：定期检查脚本的日志文件，了解脚本的运行状态和任何可能的异常情况。
测试和验证：在生产环境之前，建议在测试环境中运行和验证脚本的行为和功能，确保配置和逻辑的正确性。
通过以上步骤和注意事项，可以有效地利用该脚本实现基于 DNS 记录的服务高可用性管理。
